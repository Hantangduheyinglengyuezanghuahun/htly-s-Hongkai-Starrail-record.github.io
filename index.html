<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Track and showcase Treasures Lightward grades in Honkai: Star Rail.">
    <meta name="author" content="HTLY">
    <title>Treasures Lightward | Honkai: Star Rail</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/animate.min.css" rel="stylesheet"> 
    <link href="css/prettyPhoto.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet"> 
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->       
    <link rel="shortcut icon" href="images/ico/favicon.ico"> 
</head> 

<body id="home">

    <header id="header">
        <nav id="main-nav" class="navbar navbar-default navbar-fixed-top" role="banner">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index.html"><img src="images/logo.png" alt="logo"></a>
                </div>
                <div class="collapse navbar-collapse navbar-right">
                    <ul class="nav navbar-nav">
                        <li class="scroll active"><a href="#home">Home</a></li>
                        <li class="scroll"><a href="grades.html">Grades</a></li>
                        <li class="scroll"><a href="#profile">Profile</a></li>
                        <li class="scroll"><a href="#characters">Characters</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <section id="hero-banner" class="video-hero">
        <video class="hero-video" autoplay muted loop playsinline preload="metadata">
            <source src="images/banner/top_vedio.mp4" type="video/mp4">
            <!-- Optional: <source src="images/banner/top_vedio.webm" type="video/webm"> -->
        </video>
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1 class="site-title wow fadeInDown" data-wow-duration="900ms" data-wow-delay=".15s">
                <strong>Treasures Lightward Grade Tracker</strong>
            </h1>
            <p class="intro wow fadeInUp" data-wow-duration="900ms" data-wow-delay=".35s">
                Track and showcase my Treasures Lightward grades in Honkai: Star Rail.
            </p>
            <a class="btn btn-fancy wow fadeInUp" data-wow-duration="900ms" data-wow-delay=".55s"
               href="grades.html" role="button" aria-label="Go to the grades page">
                <span class="btn-deco left" aria-hidden="true"></span>
                View Grades
                <span class="btn-deco right" aria-hidden="true"></span>
            </a>
        </div>
    </section>

<section id="profile" class="hsr-section">
  <div class="container">
    <h2 class="section-title wow fadeInUp" data-wow-duration="800ms">My Trailblazer Profile</h2>
    <div class="row">
      <div class="col-xs-12 col-md-6 profile-col-img wow fadeInLeft" data-wow-duration="800ms" data-wow-delay=".15s">
        <img
          class="img-responsive profile-img"
          src="images/Honkai_Starrail/Profile/profile.PNG"
          srcset="images/Honkai_Starrail/Profile/profile.PNG"
          sizes="(max-width: 991px) 100vw, 50vw"
          alt="Trailblazer profile"
          loading="lazy">
      </div>
      <div class="col-xs-12 col-md-6 profile-col-text wow fadeInRight" data-wow-duration="800ms" data-wow-delay=".15s">
        <ul class="profile-list">
          <li><strong>Name:</strong> <span class="value">寒塘冷月</span></li>
          <li>
            <strong>UID:</strong>
            <span class="value" id="uid-value">139376542</span>
            <button class="btn-uid-copy" type="button"
                    aria-label="Copy UID" title="Copy UID"
                    data-copy-target="#uid-value">
              <i class="fa fa-clipboard" aria-hidden="true"></i>
            </button>
            <span class="copy-feedback" aria-live="polite" hidden>Copied!</span>
          </li>
          <li><strong>Server:</strong> <span class="value">Chinese</span></li>
          <li><strong>Notes:</strong> <span class="value">愿此行，终抵群星！</span></li>
        </ul>
      </div>
    </div>
  </div>
</section>

<section id="characters" class="hsr-section">
  <div class="container">
    <h2 class="section-title wow fadeInUp" data-wow-duration="800ms">Featured Characters</h2>

    <div class="row character-grid" id="characterGrid"></div>

    <noscript>
      <p class="text-muted small">Enable JavaScript to auto-load images from images/Honkai_Starrail/characters.</p>
    </noscript>

    <p class="text-muted small">Upload images to images/Honkai_Starrail/characters and they will appear here automatically.</p>
  </div>

  <script>
    (function () {
      const host = location.hostname.toLowerCase();
      let OWNER = 'htly-s-Honkai-Starrail-record';
      let REPO  = OWNER + '.github.io';

      if (host.endsWith('github.io')) {
        OWNER = host.split('.')[0];
        // Always use the first path segment when present (project pages),
        // otherwise fall back to <owner>.github.io (user page).
        const firstSeg = location.pathname.split('/').filter(Boolean)[0];
        REPO = firstSeg ? firstSeg : `${OWNER}.github.io`;
      }
      const USE_GITHUB = host.endsWith('github.io');

      const GALLERY_PATH = 'images/Honkai_Starrail/characters';

      const section = document.getElementById('characters');
      const grid = document.getElementById('characterGrid');

      function toTitle(name) {
        return decodeURIComponent(name.replace(/\.[^.]+$/, '').replace(/[_\-]+/g, ' '));
      }

      function addItem(file) {
        const col = document.createElement('div');
        col.className = 'col-xs-6 col-sm-4 col-md-3 wow fadeInUp';
        col.setAttribute('data-wow-duration', '800ms');

        const a = document.createElement('a');
        a.href = file.download_url || file.html_url;
        a.setAttribute('rel', "prettyPhoto[chars]");
        a.setAttribute('data-rel', "prettyPhoto[chars]");

        const img = document.createElement('img');
        img.className = 'img-responsive char-card';
        img.loading = 'lazy';
        img.src = file.download_url;
        img.alt = toTitle(file.name);

        const p = document.createElement('p');
        p.className = 'text-center';
        p.textContent = toTitle(file.name);

        a.appendChild(img);
        col.appendChild(a);
        col.appendChild(p);
        grid.appendChild(col);
      }

      async function fetchJSON(url) {
        const res = await fetch(url, { headers: { 'Accept': 'application/vnd.github+json' } });
        if (!res.ok) {
          const body = await res.text().catch(() => '');
          const err = new Error(`HTTP ${res.status} ${url} :: ${body.slice(0,200)}`);
          err.status = res.status;
          throw err;
        }
        return res.json();
      }

      async function fetchLocalList() {
        try {
          const r = await fetch(`${GALLERY_PATH}/manifest.json`, { cache: 'no-cache' });
          if (!r.ok) throw new Error(`HTTP ${r.status}`);
          const names = await r.json();
          if (!Array.isArray(names)) return [];
          return names
            .filter(n => /\.(png|jpe?g|gif|webp|svg)$/i.test(n))
            .map(name => ({
              name,
              download_url: `${GALLERY_PATH}/${encodeURIComponent(name)}`
            }));
        } catch (_) { return []; }
      }

      // Fallback: parse local directory listing HTML (e.g., python http.server)
      async function fetchDirListing() {
        try {
          const r = await fetch(`${GALLERY_PATH}/`, { cache: 'no-cache' });
          if (!r.ok || !r.headers.get('content-type')?.includes('text/html')) return [];
          const html = await r.text();
          const tmp = document.createElement('div');
          tmp.innerHTML = html;
          const files = Array.from(tmp.querySelectorAll('a'))
            .map(a => a.getAttribute('href'))
            .filter(h => h && !h.endsWith('/'))
            .map(h => decodeURIComponent(h.split('/').pop()))
            .filter(name => /\.(png|jpe?g|gif|webp|svg)$/i.test(name))
            .map(name => ({
              name,
              download_url: `${GALLERY_PATH}/${encodeURIComponent(name)}`
            }));
          return files;
        } catch (_) { return []; }
      }

      async function getDefaultBranch() {
        try {
          const info = await fetchJSON(`https://api.github.com/repos/${OWNER}/${REPO}`);
          return info.default_branch || 'main';
        } catch (e) {
          console.warn('Repo info failed, falling back to main:', e);
          return 'main';
        }
      }

      async function buildGallery() {
        if (!grid) return;

        // 1) Local manifest
        let files = await fetchLocalList();

        // 1b) Fallback to directory listing (local server with index enabled)
        if (!files.length) files = await fetchDirListing();

        if (files.length) {
          files.sort((a,b)=>a.name.localeCompare(b.name, undefined, {numeric:true, sensitivity:'base'}));
          files.forEach(addItem);
          if (window.jQuery && typeof jQuery.fn.prettyPhoto === 'function') jQuery("a[rel^='prettyPhoto']").prettyPhoto();
          if (window.WOW) new WOW({ offset:80, mobile:true, live:true }).init();
          return;
        }

        // 2) GitHub API only on GitHub Pages
        if (!USE_GITHUB) {
          const p = document.createElement('p');
          p.className = 'text-muted small';
          p.textContent = 'Add images/Honkai_Starrail/characters/manifest.json or run a local server with directory listing.';
          section.querySelector('.container').appendChild(p);
          return;
        }

        const branch = await getDefaultBranch();
        const api = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${encodeURI(GALLERY_PATH)}?ref=${encodeURIComponent(branch)}`;
        try {
          const items = await fetchJSON(api);
          const images = (Array.isArray(items)?items:[]).filter(f => f.type==='file' && /\.(png|jpe?g|gif|webp|svg)$/i.test(f.name));
          images.sort((a,b)=>a.name.localeCompare(b.name, undefined, {numeric:true, sensitivity:'base'}));
          images.forEach(addItem);
          if (window.jQuery && typeof jQuery.fn.prettyPhoto === 'function') jQuery("a[rel^='prettyPhoto']").prettyPhoto();
          if (window.WOW) new WOW({ offset:80, mobile:true, live:true }).init();
          if (!images.length) {
            const empty=document.createElement('p'); empty.className='text-muted small'; empty.textContent='No images found in the repo.'; section.querySelector('.container').appendChild(empty);
          }
        } catch(e) {
          const err = document.createElement('p');
          err.className = 'text-muted small';
          err.textContent = e?.status === 404
            ? 'Folder not found on the repo. Check path/casing and that files are pushed.'
            : `Unable to load images (HTTP ${e?.status ?? 'error'}).`;
          section.querySelector('.container').appendChild(err);
          console.warn('Gallery load failed:', e);
        }
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', buildGallery);
      } else {
        buildGallery();
      }
    })();
  </script>
</section>

    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script> 
    <script src="js/mousescroll.js"></script>
    <script src="js/smoothscroll.js"></script>
    <script src="js/jquery.prettyPhoto.js"></script>
    <script src="js/jquery.isotope.min.js"></script>
    <script src="js/jquery.inview.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/custom-scripts.js"></script>

    <script>
      // Ensure WOW animations run (including on first load)
      if (window.WOW) {
        new WOW({ offset: 80, mobile: true, live: true }).init();
      }
    </script>

    <script>
      // Keep: hide header on scroll down, show on scroll up
      (function () {
        const nav = document.getElementById('main-nav');
        if (!nav) return;
        let lastY = window.pageYOffset, hidden = false;
        window.addEventListener('scroll', () => {
          const y = window.pageYOffset, delta = y - lastY;
          if (Math.abs(delta) < 8) return;
          if (y > 60 && delta > 0 && !hidden) { nav.classList.add('nav-hidden'); hidden = true; }
          else if (delta < 0 && hidden) { nav.classList.remove('nav-hidden'); hidden = false; }
          if (y < 10) { nav.classList.remove('nav-hidden'); hidden = false; }
          lastY = y;
        }, { passive: true });
      })();
    </script>

    <script>
      (function(){
        const btn = document.querySelector('.btn-uid-copy');
        if (!btn) return;
        const feedback = btn.parentElement.querySelector('.copy-feedback');
        const targetSel = btn.getAttribute('data-copy-target');
        const target = document.querySelector(targetSel);

        async function copyText(txt){
          try {
            if (navigator.clipboard && window.isSecureContext) {
              await navigator.clipboard.writeText(txt);
            } else {
              const ta = document.createElement('textarea');
              ta.value = txt; document.body.appendChild(ta);
              ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
            }
            if (feedback){ feedback.hidden = false; setTimeout(()=> feedback.hidden = true, 1200); }
          } catch(e){ console.warn('Copy failed', e); }
        }

        btn.addEventListener('click', () => {
          const txt = target ? target.textContent.trim() : '';
          if (txt) copyText(txt);
        });
      })();
    </script>
  </body>
</html>